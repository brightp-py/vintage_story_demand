<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Product Poll</title>
    <style>
      body { font-family: sans-serif; text-align: center; margin: 40px; }
      .product { display: inline-block; margin: 20px; cursor: pointer; padding: 20px; border: 2px solid #ccc; border-radius: 10px; }
      .product:hover { border-color: #0077ff; background: #f0f8ff; }
    </style>
  </head>
  <body>
    <h1>Why would you rather buy, assuming they cost the same amount?</h1>
    <div id="options"></div>

    <script>
      const API_URL = "https://script.google.com/macros/s/AKfycby5Dh0AbrAH6-EwoFNlbldTxbThCfMUN0HdB8m-lmbxK3ftzz7KYtgzLXAigv9EwDIWaA/exec";

      let products = [];

      async function loadProducts() {
        const res = await fetch(API_URL);
        products = await res.json();
        showPair();
      }

      function randomPair() {
        let i = Math.floor(Math.random() * products.length);
        let j;
        do  { j = Math.floor(Math.random() * products.length); } while (j === i);
        return [products[i], products[j]];
      }

      function showPair() {
        const [a, b] = randomPair();
        const container = document.getElementById("options");
        container.innerHTML = "";

        [a, b].forEach((prod, idx) => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `<h2>${prod[1]}</h2>`;
          div.onclick = () => vote(prod[0], a[0], b[0]);
          container.appendChild(div);
        });
      }

      async function vote(choice, optionA, optionB) {
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify({ choice, optionA, optionB }),
          headers: { "Content-Type": "application/json" }
        });
        showPair();
      }

      loadProducts();
    </script>
  </body>
</html>
